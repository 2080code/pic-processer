<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>@2080code/pic-processer</title>
  <style>
    body{
        font-size: 12px;
        word-wrap: break-word;
        padding: 10px;
    }
    #data-url-text{
        resize: vertical;
        width: 100%;
        height: 150px;
        color: #888;
        border: 1px solid #888;
        padding: 5px;
        box-sizing: border-box;
        border-radius: 3px;
    }
    #compress-preview{
        display: none
    }
    dl dd:not(:last-child){
        margin-bottom: 5px;
    }
    label{
        font-weight: bold;
    }
    em{
        color: #888;
        text-decoration: underline;
    }
  </style>
</head>

<body>
    <header>
        <h1>@2080code/pic-processer demo</h1>
    </header>
    <article>

        <dl>
            <dt>
                <h2>选取图片</h2>
            </dt>
            <dd>
                <input type="file" id="file" draggable onchange="handle()"/>
            </dd>
        </dl>
    
        <dl>
            <dt><h2>getDataURL</h2></dt>
            <dd>
            </dd>
            <dd>
                原始图片转为 dataURL：
                <textarea name="" id="data-url-text" readonly></textarea>
            </dd>
        </dl>
    
        <hr/>
    
        <dl>
            <dt><h2>compress</h2></dt>
            <dd>
                <label for="compress-ratio">ratio：</label>
                <select name="ratio" id="compress-ratio" onchange="handle()">
                    <option value="1" selected>1（无压缩，输出字节可能会远大于原图）</option>
                    <option value="0.8">0.8</option>
                    <option value="0.6">0.6</option>
                    <option value="0.4">0.4</option>
                    <option value="0.2">0.2</option>
                </select>
            </dd>
            <dd>
                <label for="compress-max-width">maxWidth：</label>
                <input type="number" inputmode="numeric" id="compress-max-width" onchange="handle()"/>px
            </dd>
            <dd>
                <label for="compress-mime">mime：</label>
                <select name="mime" id="compress-mime" onchange="handle()">
                    <option value="image/jpeg" selected>image/jpeg</option>
                    <option value="image/png">image/png</option>
                </select>
            </dd>
            <dd>
                <div id="compress-result"></div>
            </dd>
            <dd>
                <img id="compress-preview" src="" alt="preview">
            </dd>
        </dl>
    
        <hr/>
    
        <dl>
            <dt><h2>dataURLtoFile</h2></dt>
            <dd>
                通过以上 compress 方法输出的 dataURL 被转为 File 对象后的信息:
                <div id="file-info"><em>请先在 compress 中选择文件</em></div>
            </dd>
        </dl>
        
        <hr/>
    </article>

    <script src="../lib/pic-processer.min.js"></script>
    <script>
        const picProcesser=new PicProcesser()

        // getDataURL
        async function getDataURLHandle(){
        }
        
        // compress
        async function handle(){
            // about getDataURL
            const file=document.getElementById('file').files[0]
            const dataURL=await picProcesser.getDataURL(file)
            // 在 fileInput元素下方显示dataURL
            const dataURLText=document.getElementById('data-url-text')
            dataURLText.value=dataURL
            dataURLText.scrollTop=0

            // about compress
            const compressRatio=document.getElementById('compress-ratio')
            const compressMaxWidth=document.getElementById('compress-max-width')
            const compressMime=document.getElementById('compress-mime')
            const compressedDataURL=await picProcesser.compress(file,+compressRatio.value,+compressMaxWidth.value,compressMime.value)
            const compressPreview=document.getElementById('compress-preview')
            
            console.log('compress',file,compressRatio.value,compressedDataURL.length)
            
            compressPreview.src=compressedDataURL
            compressPreview.style.display='initial'

            // about dataURLtoFile
            const exportedFile=await picProcesser.dataURLtoFile(file.name,compressedDataURL)
            document.getElementById('compress-result').innerHTML=`
                original file size: <em>${file.size} byte</em>,
                compressed file size: <em>${exportedFile.size} byte</em>
            `

            document.getElementById('file-info').innerHTML=`
                <div>name: <em>${exportedFile.name}</em></div>
                <div>size: <em>${exportedFile.size} byte</em></div>
                <div>type: <em>${exportedFile.type}</em></div>
            `
        }
    </script>
</body>

</html>
